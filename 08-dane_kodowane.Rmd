---
knit: bookdown::preview_chapter
---

# Estymacja lokalnego rozkładu prawdopodobieństwa {#estymacja-lokalnego-rozkadu-prawdopodobienstwa}

```{r}
library('geostatbook')
data(punkty)
data(siatka)
```

```{r setup8, echo=FALSE, include=FALSE}
library('knitr')
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
```

```{r, echo=FALSE}
par(mar=c(rep(0, 4)))
```

## Kriging danych kodowanych

### Kriging danych kodowanych (ang. *Indicator kriging*)
- Jest to metoda krigingu oparta o dane kategoryzowane lub też dane przetworzone z postaci ciągłej do binarnej
- Zazwyczaj używana jest to oszacowania prawdopodobieństwa przekroczenia zdefiniowanej wartości progowej
- Może być też używana do szacowania wartości z całego rozkładu
- Wartości danych wykorzystywane do krigingu danych kodowanych są określone jako 0 lub 1
- Powyzsze kategorie reprezentują czy wartość danej zmiennej jest powyżej czy poniżej określonego progu

<!--http://geostat-course.org/system/files/geostat13_ind.pdf-->

### Wady i zalety krigingu danych kodowanych
- Zalety:
    - Możliwość zastosowania, gdy nie interesuje nas konkretna wartość, ale znalezienie obszarów o wartości przekraczającej dany poziom
    - Nie jest istotny kszałt rozkładu
- Wady:
    - Potencjalnie trudne do modelowania semiwariogramy (szczególnie skrajnych przedziałów)
    - Czasochłonność/pracochłonność
    
## Kriging danych kodowanych | Przykłady

### Binaryzacja danych

```{r }
summary(punkty$temp) 
punkty$temp_ind <- punkty$temp > 20
summary(punkty$temp_ind) 
```

### Eksploracja danych

```{r }
ggplot(punkty@data, aes(temp)) + stat_ecdf()
```

### Kriging danych kodowanych (ang. *Indicator kriging*) | Semiwariogram

```{r }
vario_ind <- variogram(temp_ind~1, punkty)         
plot(vario_ind)
```

### Kriging danych kodowanych (ang. *Indicator kriging*) | Modelowanie

```{r }
model_ind <- vgm(0.07, model = 'Sph', range = 3000,  nugget = 0.01)  
plot(vario_ind, model=model_ind)
fitted_ind <- fit.variogram(vario_ind, model_ind)
fitted_ind
plot(vario_ind, model=fitted_ind)
```

### Kriging danych kodowanych (ang. *Indicator kriging*) | Interpolacja

```{r }
ik <- krige(temp_ind~1, punkty, siatka, model=fitted_ind)
```

```{r plotsy1ok, eval=FALSE}
spplot(ik, 'var1.pred')
spplot(ik, 'var1.var')
```

```{r plotsy2ok, echo=FALSE, fig.height=8}
library('gridExtra')
ps.options(encoding='CP1250')
p1 <- spplot(ik, "var1.pred", main='Prawdopodobieństwo Temp > 20')
p2 <- spplot(ik, "var1.var", main='Wariancja predykcji IK')
grid.arrange(p1, p2, ncol=1)
```

### Kriging danych kodowanych (ang. *Indicator kriging*)

```{r }
vario_ind20 <- variogram(I(temp<20)~1, punkty)  
fitted_ind20 <- fit.variogram(vario_ind20, vgm(0.08, 'Sph', 3500, nugget=0.01))
vario_ind16 <- variogram(I(temp<16)~1, punkty)  
fitted_ind16 <- fit.variogram(vario_ind16, vgm(0.18, 'Sph', 3500, nugget=0.03))
vario_ind12 <- variogram(I(temp<12)~1, punkty)  
fitted_ind12 <- fit.variogram(vario_ind12, vgm(0.13, 'Sph', 2000, nugget=0.03))

ik20 <- krige(I(temp<20)~1, punkty, siatka, model=fitted_ind20, nmax=30)
ik16 <- krige(I(temp<16)~1, punkty, siatka, model=fitted_ind16, nmax=30)
ik12 <- krige(I(temp<12)~1, punkty, siatka, model=fitted_ind12, nmax=30)
```

```{r ploty_trzyik, echo=FALSE, fig.height=12}
library('gridExtra')
ps.options(encoding='CP1250')
p1 <- spplot(ik20, "var1.pred", main="Prawdopodobieństwo Temp < 20")
p2 <- spplot(ik16, "var1.pred", main="Prawdopodobieństwo Temp < 16")
p3 <- spplot(ik12, "var1.pred", main="Prawdopodobieństwo Temp < 12")
grid.arrange(p1, p2, p3, ncol=1)
```
