---
knit: bookdown::preview_chapter
---

# Eksploracyjna analiza danych nieprzestrzennych

```{r setup2, echo=FALSE, include=FALSE}
library('knitr')
library('methods')
opts_chunk$set(warning=FALSE, message=FALSE) 
```

## Eksploracyjna analiza danych | Cel
- Ogólna charakterystyka danych oraz badanego zjawiska
- Określenie przestrzennego/czasowego typu próbkowania
- Informacja o relacji pomiędzy lokalizacją obserwacji a czynnikami wpływającymi na zmienność przestrzenną cechy

## Dane
### Dane 

```{r}
library('geostatbook')
data(punkty)
```

```{r}
str(punkty)
str(punkty@data)
```

```{r, echo=FALSE}
par(mar=c(rep(0, 4)))
```

```{r, message=FALSE, warning=FALSE}
plot(punkty)
data(granica)
plot(granica, add=TRUE)
```

## Statystyki opisowe
### Statystyki opisowe

```{r }
summary(punkty@data)
```

### Statystyki opisowe | średnia i mediana

```{r }
median(punkty$temp, na.rm=TRUE)
mean(punkty$temp, na.rm=TRUE)
```

- W wypadku symetrycznego rozkładu te dwie cechy są równe
- Średnia jest bardziej wrażliwa na wartości odstające
- Mediana jest lepszą miarą środka danych, jeżeli są one skośne

Po co używać średniej?

- Bardziej przydatna w przypadku małych zbiorów danych
- Gdy rozkład danych jest symetryczny
- (Jednak) często warto podawać obie miary
  
### Statystyki opisowe | minimum i maksimum

```{r }
min(punkty$temp, na.rm=TRUE)
max(punkty$temp, na.rm=TRUE)
```

### Statystyki opisowe | ochylenie standardowe
![](figs/sd.png)

```{r }
sd(punkty$temp, na.rm=TRUE)
```

## Wykresy
### Histogram

```{r }
ggplot(punkty@data, aes(temp)) + geom_histogram()
```

- Stworzony przez Karla Pearsona
- Jest graficzną reprezentacją rozkładu danych
- Wartości danych są łączone w przedziały (na osi poziomej) a na osi pionowej jest ukazana liczba punktów (obserwacji) w każdym przedziale
- Różny dobór przedziałów może dawać inną informację
- W pakiecie `ggplot2`, domyślnie przedział to zakres/30

### Estymator jądrowy gęstości (ang. *kernel density estimation*)

```{r }
ggplot(punkty@data, aes(temp)) + geom_density()
```

### Wykresy kwantyl-kwantyl (ang.*quantile-quantile*)

```{r }
ggplot(punkty@data, aes(sample=temp)) + stat_qq()
```

http://stats.stackexchange.com/questions/101274/how-to-interpret-a-qq-plot
![http://stats.stackexchange.com/questions/101274/how-to-interpret-a-qq-plot](figs/qq.png)

### Dystrybuanta (CDF)
- Dystrybuanta (ang. *conditional density function* - CDF) wyświetla prawdopodobieństwo, że wartość zmiennej przewidywanej jest mniejsza lub równa określonej wartości

```{r }
ggplot(punkty@data, aes(temp)) + stat_ecdf()
```

## Porównanie zmiennych

### Kowariancja
- Kowariancja jest nieunormowaną miarą zależności liniowej pomiędzy dwiema zmiennymi
- Kowariancja dwóch zmiennych $x$ i $y$ pokazuje jak dwie zmienne są ze sobą liniowo powiązane
- Dodatnia kowariancja wzkazuje na pozytywną relację liniową pomiędzy zmiennymi, podczas gdy ujemna kowariancja świadczy o odwrotnej sytuacji
- Jeżeli zmienne nie są ze sobą liniowo powiązane, wartość kowariacji jest bliska zeru
- Inaczej mówiąc, kowariancja stanowi miarę wspólnej zmienności dwóch zmiennych  
- Wielkość samej kowariancji uzależniona jest od przyjętej skali zmiennej (jednostki)
- Inne wyniku uzyskamy (przy tej samej zależności pomiędzy parą zmiennych), gdy będziemy analizować wyniki np. wieku i dochodu w złotówkach a inne dla wieku i dochodu w dolarach

```{r }
cov(punkty$temp, punkty$ndvi, use='complete.obs')
```

### Współczynnik korelacji
- Wspołczynnik korelacji to unormowana miara zależności pomiędzy dwiema zmiennymi, przyjmująca wartości od -1 do 1
- Współczynnik korelacji jest uzyskiwany poprzez podzielenie wartości kowariancji przez odchylenie standardowe wyników
- Z racji unormowania nie jest ona uzależniona od jednostki

```{r }
ggplot(punkty@data, aes(temp, ndvi)) + geom_point()
cor(punkty$temp, punkty$ndvi, use='complete.obs')
```

```{r }
cor.test(punkty$temp, punkty$ndvi)
```

```{r }
cor(punkty@data[c(1, 3:5)], use='complete.obs')
```

```{r }
corrplot(cor(punkty@data[c(1, 3:5)], use='complete.obs'))
```

### Wykresy pudełkowe

```{r }
punkty$clc <- as.factor(punkty$clc)
ggplot(punkty@data, aes(clc, temp)) + geom_boxplot()
```

- Obrazuje pięc podstawowych statystyk opisowych oraz wartości odstające
- Pudełko to zakres międzykwantylowy
- Linie oznaczają najbardziej ekstremalne wartości, ale nie odstające. Górna to 1,5\*IQR ponad krawędź pudełka, dolna to 1,5\*IQR poniżej wartości dolnej krawędzi pudełka
- Linia środkowa to mediana

<!--
1. Tereny komunikacyjne i porty
2. Zabudowa luźna, złożone systemy upraw i działek
3. Grunty orne, Łąki
4. Lasy liściaste,  Lasy iglaste, mieszane
5. Bagna, Torfowiska
6. Zbiorniki wodne
-->

### Testowanie istotności różnić średniej pomiędzy grupami

```{r }
punkty$clc <- as.factor(punkty$clc)
aov_test <- aov(temp~clc, data=punkty)
summary(aov_test)
```

```{r, echo=FALSE}
dev.off()
```

```{r }
tukey <- TukeyHSD(aov_test, 'clc')
plot(tukey, las=1)
```

## Transformacje danych
### Transformacje danych
- Transformacja danych może mieć na celu ułatwienie porównywania różnych zmiennych, zniwelowanie skośności rozkładu lub też zmniejszenie wpływu danych odstających
- Centrowanie i skalowanie (standaryzacja):
    - Centrowanie danych - wybierana jest przeciętna wartość predyktora, a następnie od wszystkich wartości predyktorów odejmowana jest wybrana wcześniej wartość
    - Skalowanie danych - dzielenie każdej wartości predyktora przez jego odchylenie standardowe
    - Wadą tego podjeścia jest główne zmniejszenie interpretowalności pojedynczych wartości
- Redukcja skośności:
    - Logarytmizacja
    - Pierwiastkowanie
    - Rodzina transformacji Boxa Coxa
    - Inne    

### Transformacja danych | Logarytmizacja

```{r }
ggplot(punkty@data, aes(temp)) + geom_density()
punkty$log_tpz <- log(punkty$temp)
ggplot(punkty@data, aes(log_tpz)) + geom_density()
punkty$exp_tpz <- exp(punkty$log_tpz)
ggplot(punkty@data, aes(exp_tpz)) + geom_density()
```

### Transformacja danych | Pierwiastkowanie

```{r }
ggplot(punkty@data, aes(temp)) + geom_density()
punkty$sqrt_tpz <- sqrt(punkty$temp)
ggplot(punkty@data, aes(sqrt_tpz)) + geom_density()
punkty$pow_tpz <- punkty$sqrt_tpz^2
ggplot(punkty@data, aes(pow_tpz)) + geom_density()
```

### Transformacja danych | Rodzina transformacji Boxa Coxa

```{r }
ggplot(punkty@data, aes(temp)) + geom_density()
transformacja <- BoxCoxTrans(punkty$temp)
transformacja
punkty$bc_tpz <- predict(transformacja, punkty$temp)
ggplot(punkty@data, aes(bc_tpz)) + geom_density()
invBoxCox <- function(x, lambda) if (lambda == 0) exp(x) else (lambda*x + 1)^(1/lambda) 
punkty$bc_tpz_inv <- invBoxCox(punkty$bc_tpz, lambda=-0.3)
ggplot(punkty@data, aes(bc_tpz_inv)) + geom_density()
```

