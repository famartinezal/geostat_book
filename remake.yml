sources: R/
  
packages:
  - XML
  - sp
  - raster
  - rgeos
  - magrittr	

targets:
  all:
    depends:
      - dane/punkty.rds
      - dane/siatka.rds
      - dane/punkty.csv
      - dane/granica.shp
      - dane/siatka.tif
      - dane/siatka.shp
      - dane/siatka.csv
      - dane/punkty_pref.csv
      - dane/punkty_ndvi.csv

  data:
    depends:
      - granica_spk 

  data/parki_krajobrazowe_pl.zip:
    command: download_granica_spk(target_name)
  granica_spk:
    command: process_granica_spk("data/parki_krajobrazowe_pl.zip")
    cleanup_level: never

  data/clc/g100_06.tif:
    command: download_clc()
  data/clc06_spk.tif:
    command: process_clc("data/clc/g100_06.tif", granica_spk)
    cleanup_level: never
    
  data/srtm_41_02.zip:
    command: download_srtm(target_name)
  data/srtm_spk.tif:
    command: process_srtm("data/srtm_41_02.zip", granica_spk)
    cleanup_level: never
    
  data/LC81870222015186LGN00_B10.tif:
    command: download_landsat8(target_name, band=10)
  data/LC81870222015186LGN00_B11.tif:
    command: download_landsat8(target_name, band=11)
  cropped_landsat1011:  
    command: crop_landsat("data/LC81870222015186LGN00_B10.tif", "data/LC81870222015186LGN00_B11.tif", granica_spk)
  data/landsat8_temperature_spk.tif:
   command: process_landsat8_temp(cropped_landsat1011)
   cleanup_level: never
   
  data/LC81870222015186LGN00_B4.tif:
    command: download_landsat8(target_name, band=4)
  data/LC81870222015186LGN00_B5.tif:
    command: download_landsat8(target_name, band=5)
  cropped_landsat45:  
    command: crop_landsat("data/LC81870222015186LGN00_B4.tif", "data/LC81870222015186LGN00_B5.tif", granica_spk)
  data/landsat8_ndvi_spk.tif:  
    command: process_landsat8_ndvi(cropped_landsat45, type=1)
    cleanup_level: never
  data/landsat8_savi_spk.tif:  
    command: process_landsat8_ndvi(cropped_landsat45, type=2)  
    cleanup_level: never
    
  raster_stack:
    command: data_merger(granica_spk, "data/srtm_spk.tif", "data/clc06_spk.tif", "data/landsat8_temperature_spk.tif", "data/landsat8_ndvi_spk.tif", "data/landsat8_savi_spk.tif")
  data/raster_stack.rds:
    command: saveRDS(raster_stack, "data/raster_stack.rds")
    cleanup_level: never 
  spdf_all:
    command: raster_to_sp(raster_stack)
  spdf_all_without_temp:
    command: raster_to_sp2(raster_stack)  
    
  points:
    command: spatial_pixels_to_points(spdf_all, n=250, type=1)
    cleanup_level: never 
  points2:
    command: spatial_pixels_to_points(spdf_all, n=500, type=1)
    cleanup_level: never   
  points_pref:
    command: spatial_points_stratified(points2, threshold=16, prop=0.25)
  ndvi_points:
    command: spatial_pixels_to_points(spdf_all, n=1000, type=1, only_ndvi=TRUE)
    cleanup_level: never     
    
  dane/punkty.rds:
    command: saveRDS(points, "dane/punkty.rds")
  points_df:
    command: as.data.frame(points)
  siatka_df:
    command: as.data.frame(spdf_all_without_temp)
  dane/siatka.csv:
    command: write.csv(siatka_df, "dane/siatka.csv", row.names=FALSE)  
  dane/punkty.csv:
    command: write.csv(points_df, "dane/punkty.csv", row.names=FALSE)  
  points_df_pref:
    command: as.data.frame(points_pref)
  dane/punkty_pref.csv:
    command: write.csv(points_df_pref, "dane/punkty_pref.csv", row.names=FALSE)      
  dane/siatka.tif:
    command: writeRaster(raster_stack, "dane/siatka.tif", overwrite=TRUE)
  dane/siatka.shp:
    command: shapefile(spdf_all_without_temp, "dane/siatka.shp", overwrite=TRUE)
  dane/siatka.rds:  
    command: saveRDS(spdf_all_without_temp, "dane/siatka.rds")
  dane/granica.shp:
    command: shapefile(granica_spk, "dane/granica.shp", overwrite=TRUE)
  ndvi_points_df:
    command: as.data.frame(ndvi_points)
  dane/punkty_ndvi.csv:
    command: write.csv(ndvi_points_df, "dane/punkty_ndvi.csv", row.names=FALSE)    
